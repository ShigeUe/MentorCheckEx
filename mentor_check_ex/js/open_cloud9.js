(()=>{"use strict";class t{_element;constructor(t){this._element=this.initialize(t)}initialize(t){return"string"==typeof t?document.createElement(t):"object"==typeof t?t:document.createElement("s")}static create(e){return new t(e)}addClass(t){return"string"==typeof t&&""!==t?this._element.classList.add(t):t&&"Array"===t.constructor.name&&t.forEach((t=>this.addClass(t)),this),this}removeClass(t){return this._element.classList.remove(t),this}addEventListener(t,e){return this._element.addEventListener(t,e),this}prop(t,e){if("object"==typeof t)this._setObjectProp(this._element,t);else{const s=this._element;if(void 0===e)return t in s?String(s[t]):"";t in s&&(s[t]=e)}return this}_setObjectProp(t,e){Object.keys(e).forEach((s=>{const r=e[s];"object"==typeof r?this._setObjectProp(t[s],r):t[s]=r}),this)}get(){return this._element}set(t){return this._element=this.initialize(t),this}appendChild(e){return this._element.append(e instanceof t?e.get():e),this}insertFirst(e){return this._element.insertBefore(e instanceof t?e.get():e,this._element.firstChild),this}text(t){return void 0===t?this._element.innerText:(this._element.innerText=t,this)}style(t){return Object.keys(t).forEach((e=>{console.log(e,t[e]),this._element.style.setProperty(e,t[e])}),this),this}}class e{static DEFAULT={interval:30,chime:!1,notify:!1,smartIfSimple:!1,new_version:!1,username:"",password:"",volume:50,course_list:[],watchSlack:!1,darkmode:!1,diff:!0,diffFromGit:!1,curriculumSubMenu:!1,curriculums:[]};props=e.DEFAULT;async getSettings(){this.props=await chrome.storage.local.get(e.DEFAULT)}async setSettings(){await chrome.storage.local.set(this.props)}get interval(){return this.props.interval}get chime(){return this.props.chime}get notify(){return this.props.notify}get smartIfSimple(){return this.props.smartIfSimple}get new_version(){return this.props.new_version}get username(){return this.props.username}get password(){return this.props.password}get volume(){return this.props.volume}get course_list(){return this.props.course_list}get watchSlack(){return this.props.watchSlack}get darkmode(){return this.props.darkmode}get diff(){return this.props.diff}get diffFromGit(){return this.props.diffFromGit}get curriculumSubMenu(){return this.props.curriculumSubMenu}get curriculums(){return this.props.curriculums}set interval(t){this.props.interval=t}set chime(t){this.props.chime=t}set notify(t){this.props.notify=t}set smartIfSimple(t){this.props.smartIfSimple=t}set new_version(t){this.props.new_version=t}set username(t){this.props.username=t}set password(t){this.props.password=t}set volume(t){this.props.volume=t}set course_list(t){this.props.course_list=t}set watchSlack(t){this.props.watchSlack=t}set darkmode(t){this.props.darkmode=t}set diff(t){this.props.diff=t}set diffFromGit(t){this.props.diffFromGit=t}set curriculumSubMenu(t){this.props.curriculumSubMenu=t}set curriculums(t){this.props.curriculums=t}}class s{#t=document.body;queryId(t){return s.queryId(t)}static queryId(t){const e=document.getElementById(t);if(null===e)throw new Error(`要素が取得できませんでした。ID:${t}`);return e}static queryAll(t){return document.querySelectorAll(t)}queryAll(t){return this.#t.querySelectorAll(t)}static query(t,e){return s._query(null,t,e??!1)}query(t,e){return s._query(this.#t,t,e??!1)}static _query(t,e,s){const r=(t??document).querySelector(e);if(null===r){if(void 0===s||void 0!==s&&!s)throw new Error(`要素が取得できませんでした。Selector:${e}`);return null}return r}get_document(){return this.#t}set_document(t){return this.#t=t,this}static notify(t,e){chrome.runtime.sendMessage({type:"notification",title:t,body:e})}}class r{cloud9Url="";awsUrl="";awsWindow;settings;win;constructor(t=window){this.win=t,this.awsWindow=t,this.settings=new e}async initialize(){chrome.runtime.sendMessage({}),this.getAWSLink()&&(await this.settings.getSettings(),await this.configureCloud9Button())}getAWSLink(){const t=s.query('#page-content-wrapper a[href*="signin.aws.amazon.com/console"]',!0);return!!t&&(this.awsUrl=t.href,!0)}openNamedWindow(t){const e=this.win.open(t,"AWSOpenedFromMentorCheckEx");if(e)return e;throw Error("AWSのWindowが開けませんでした")}async fetchUsernameAndPassword(){const t=s.query('a[href*="signin.aws.amazon.com/console"] + div > div',!0);if(t){const e=t.innerHTML.split("<br>");if(e.length<3)return;this.settings.username=e[1].split(" ")[1],this.settings.password=e[2].split(" ")[1],await this.settings.setSettings()}}sendUsernameAndPassword(t){this.awsWindow.postMessage({username:this.settings.username,password:this.settings.password},t.origin)}handleMessageFromAWSWindow(t){this.win.addEventListener("message",(e=>{e.origin.includes("signin.aws.amazon.com")&&"loaded"===e.data&&this.sendUsernameAndPassword(e),e.origin.includes("console.aws.amazon.com")&&"loaded"===e.data&&this.openNamedWindow(t)}))}installCloud9Button(e){s.queryAll('a[href*="aws.amazon.com/cloud9"]').forEach((s=>{const r=new t("button").text("自動でCloud9を開く").addClass("auto-open-the-cloud9").addEventListener("click",(t=>(t.preventDefault(),this.onOpenCloud9ButtonClicked(s,e),!1)));s.after(r.get())}),this)}onOpenCloud9ButtonClicked(t,e){this.cloud9Url=t.href,this.awsWindow=this.openNamedWindow(e)}async configureCloud9Button(){this.settings.username||await this.fetchUsernameAndPassword(),this.handleMessageFromAWSWindow(this.cloud9Url),this.installCloud9Button(this.awsUrl)}}(async()=>{await(new r).initialize()})()})();