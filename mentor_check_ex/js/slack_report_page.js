(()=>{"use strict";class e{_element;constructor(e){this._element="string"==typeof e?document.createElement(e):"object"==typeof e?e:document.createElement("s")}static create(t){return new e(t)}addClass(e){return"string"==typeof e&&""!==e?this._element.classList.add(e):e&&"Array"===e.constructor.name&&e.forEach((e=>this.addClass(e)),this),this}removeClass(e){return this._element.classList.remove(e),this}addEventListener(e,t){return this._element.addEventListener(e,t),this}prop(e,t){if("object"==typeof e)this._setObjectProp(this._element,e);else{const r=this._element;if(void 0===t)return e in r?String(r[e]):"";e in r&&(r[e]=t)}return this}_setObjectProp(e,t){Object.keys(t).forEach((r=>{const n=t[r],a=e;"object"==typeof n?this._setObjectProp(a[r],n):a[r]=n}),this)}get(){return this._element}set(e){return this.constructor(e),this}appendChild(t){return this._element.append(t instanceof e?t.get():t),this}insertFirst(t){return this._element.insertBefore(t instanceof e?t.get():t,this._element.firstChild),this}text(e){return void 0===e?this._element.innerText:(this._element.innerText=e,this)}style(e){return Object.keys(e).forEach((t=>{this._element.style.setProperty(t,e[t])}),this),this}}const t=new class{#e=document.body;queryId(e){const t=document.getElementById(e);if(null===t)throw new Error(`要素が取得できませんでした。ID:${e}`);return t}static queryId(e){const t=document.getElementById(e);if(null===t)throw new Error(`要素が取得できませんでした。ID:${e}`);return t}static queryAll(e){return document.querySelectorAll(e)}queryAll(e){return this.#e.querySelectorAll(e)}static query(e,t){const r=document.querySelector(e);if(null===r){if(void 0===t||void 0!==t&&!t)throw new Error(`要素が取得できませんでした。Selector:${e}`);return null}return r}query(e,t){const r=this.#e.querySelector(e);if(null===r){if(void 0===t||void 0!==t&&!t)throw new Error(`要素が取得できませんでした。Selector:${e}`);return null}return r}get_document(){return this.#e}set_document(e){return this.#e=e,this}};document.title="課題レビューの新着一覧 | TechAcademy mentor",t.query("#sidebar-wrapper").remove(),t.query("#wrapper").style.padding="0",t.set_document(t.query("#page-content-wrapper .container-fluid .row .col-lg-12")),t.query("h2").innerText="課題レビューの新着一覧",t.query("ul.pagination",!0)&&t.query("ul.pagination").remove(),t.query(".breadcrumb",!0)&&t.query(".breadcrumb").remove(),t.query("ul.nav.nav-tabs",!0)&&t.query("ul.nav.nav-tabs").remove(),t.query("ul.nav.nav-pills",!0)&&t.query("ul.nav.nav-pills").remove(),t.query("div").remove(),t.query("table",!0)&&t.query("table").remove(),t.query("p",!0)&&t.query("p").remove(),t.get_document().appendChild(e.create("p").text("このページを開いてSlackをブラウザで開くと、ここに課題レビュー通知が表示されます。\nブックマークしておくと便利です。\n").get()),t.get_document().appendChild(e.create("table").addClass(["table","table-striped"]).appendChild(e.create("thead")).appendChild(e.create("tbody")).get()),document.body.style.height="calc(100% - 50px)";const r=t.query("table thead"),n=e.create("tr"),a=e.create("th"),o=e.create("th").text("ワークスペース"),l=e.create("th").text("メッセージ"),i=e.create("th").text("通知日時");n.appendChild(a).appendChild(o).appendChild(l).appendChild(i),r.appendChild(n.get());let s=null;const d=()=>{console.debug((new Date).toLocaleString()+" Connect to the background."),s=chrome.runtime.connect("",{name:"SlackToBg"}),s.onDisconnect.addListener((()=>{console.debug((new Date).toLocaleString()+" Disconnected from the background."),setTimeout(d,1e3)})),s.onMessage.addListener(((r,n)=>{"SlackToBg"===n.name&&"addReview"===r?.type&&(r.desc.match(/課題.+提出/)?(async(r,n)=>{const a=await fetch(r),o=await a.text(),l=document.implementation.createHTMLDocument("").documentElement;l.innerHTML=o;const[i]=l.querySelector("title").innerText.split("|"),s="review"+Date.now(),d=t.query("table tbody"),c=e.create("tr").prop("id",s),u=e.create("a").addClass(["btn","btn-default","btn-sm"]).prop({target:"_blank",dataset:{method:"post"}}).prop("href",r+"/start_review").text("開始");u.get().addEventListener("click",(()=>{t.queryId(s).remove()}));const p=e.create("a").addClass(["btn","btn-default","btn-sm","add-margin-left-10"]).prop({target:"_blank"}).prop("href",r).text("詳細"),h=e.create("td").appendChild(u).appendChild(p),m=e.create("td").text(n),y=e.create("td").text(i),b=e.create("td").text((new Date).toLocaleString());c.appendChild(h).appendChild(m).appendChild(y).appendChild(b),d&&d.appendChild(c.get())})(r.url,r.title):(e=>{const r=t.query(`a[href^='${e}']`);r.parentElement&&r.parentElement.parentElement&&r.parentElement.parentElement.remove()})(r.url))}))};d()})();